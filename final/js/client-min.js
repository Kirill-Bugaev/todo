function responseHandler(e,t,n){4==e.readyState&&(200==e.status?e.responseText?n(t(e.responseXML)):alert("Communication error: No data received"):alert("Communication error: "+e.statusText))}function asyncRequest(e,t,n){let r=new XMLHttpRequest;return r.open("POST",e,!0),r.onreadystatechange=function(){responseHandler(this,t,n)},r}function setRequestHeader(e,t){e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.setRequestHeader("Content-length",t),e.setRequestHeader("Connection","close")}function xmlErrorCheck(e){if(!e)return alert("Server error: bad XML"),0;let t=e.getElementsByTagName("error")[0];if(t){let e="Server error: ";return t.childNodes.length>0?e+=t.childNodes[0].nodeValue:e+="unknown",alert(e),0}return 1}function getTasksResponseHandler(e){if(!xmlErrorCheck(e))return[];let t=e.getElementsByTagName("task"),n=[];for(let e=0;e<t.length;e++){let r=new Object;r.dbId=t[e].getAttribute("id"),r.date=t[e].getAttribute("date"),r.color=t[e].getAttribute("color"),r.text=t[e].childNodes[0].nodeValue,r.done=t[e].getAttribute("done"),n.push(r)}return n}function addTasksResponseHandler(e){if(!xmlErrorCheck(e))return null;let t=new Object,n=e.getElementsByTagName("task");return 0==n.length?(alert("Server error: Bad response"),t.dbId=0,t.date=0):(t.dbId=n[0].getAttribute("id"),t.date=n[0].getAttribute("date")),t}function removeTaskResponseHandler(e){return xmlErrorCheck(e)?1:null}function editTaskResponseHandler(e){return xmlErrorCheck(e)?1:null}function clientGetTasks(e){asyncRequest("./php/get-tasks.php",getTasksResponseHandler,e).send(null)}function clientAddTask(e,t){let n=asyncRequest("./php/add-task.php",addTasksResponseHandler,t),r="text="+encodeURIComponent(e.text);setRequestHeader(n,(r+="&color="+e.color+"&done="+e.done).length),n.send(r)}function clientRemoveTask(e,t){let n=asyncRequest("./php/remove-task.php",removeTaskResponseHandler,t),r="id="+e;setRequestHeader(n,r.length),n.send(r)}function clientEditTask(e,t){let n=asyncRequest("./php/edit-task.php",editTaskResponseHandler,t),r="id="+e.dbId;null!=e.color&&(r+="&color="+e.color),null!=e.done&&(r+="&done="+e.done),null!=e.text&&(r+="&text="+encodeURIComponent(e.text)),setRequestHeader(n,r.length),n.send(r)}