function getStyle(e,t){var n,l=(e.ownerDocument||document).defaultView;return l&&l.getComputedStyle?(t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),l.getComputedStyle(e,null).getPropertyValue(t)):e.currentStyle?(t=t.replace(/-(\w)/g,function(e,t){return t.toUpperCase()}),n=e.currentStyle[t],/^\d+(em|pt|%|ex)?$/i.test(n)?function(t){var n=e.style.left,l=e.runtimeStyle.left;return e.runtimeStyle.left=e.currentStyle.left,e.style.left=t||0,t=e.style.pixelLeft+"px",e.style.left=n,e.runtimeStyle.left=l,t}(n):n):void 0}let _touchtime=0;function doubleClickHook(e){0==_touchtime?_touchtime=(new Date).getTime():(new Date).getTime()-_touchtime<800?(e(),_touchtime=0):_touchtime=(new Date).getTime()}const taskColors=["default","red","green","yellow","blue","purple","super"],btnHeightAdd=4,btnWidthAdd=0;var _taskIndex=0;function extractTaskIdPrefix(e){return e.match(/^task(\d*)/g)}function removeElementById(e){var t=document.getElementById(e);return t.parentNode.removeChild(t)}function insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function addLeadingZero(e){let t=e.toString();return 2==t.length?t:"0"+t}function timeToStr(e){let t=new Date(e),n=addLeadingZero(t.getDate()),l=addLeadingZero(t.getMonth()+1),o=addLeadingZero(t.getHours()),d=addLeadingZero(t.getMinutes());return n+"-"+l+"-"+t.getFullYear()+" "+o+":"+d}function equalizeBtnSize(){let e=document.getElementById("btn-equalizer"),t=getStyle(e,"height"),n=getStyle(e,"width"),l=":root{"+("--btn-height:"+(Math.round(parseFloat(t,10))+btnHeightAdd+"px")+";--btn-width:"+(Math.round(parseFloat(n,10))+btnWidthAdd+"px")+";")+"}",o=document.createElement("style");o.type="text/css",o.innerHTML=l,document.getElementsByTagName("head")[0].appendChild(o),e.parentNode.removeChild(e)}function loadStyles(){let e=document.getElementById("theme-select");""==document.cookie?e.selectedIndex=0:e.selectedIndex=document.cookie;let t=document.createElement("link");t.id="theme-style",t.href="./css/"+e.value+".css",t.type="text/css",t.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(t),equalizeBtnSize()}function changeStyle(e){document.getElementById("theme-style").href="./css/"+e+".css",document.cookie=document.getElementById("theme-select").selectedIndex}function filterTasks(){let e=document.getElementById("filter-done-select"),t=e.options[e.selectedIndex].value,n=document.getElementById("filter-color-select"),l=n.options[n.selectedIndex].value,o=taskColors.indexOf(l);for(let e=0;e<_taskIndex;e++){let n="task"+e,l=document.getElementById(n+"-cont");if(!l)continue;let d="none"==getStyle(document.getElementById(n+"-done-label"),"display")?0:1,a=document.getElementById(n+"-color-select");!("all"==t||"done"==t&&1==d||"undone"==t&&0==d)||-1!=o&&a.selectedIndex!=o?l.style.display="none":l.style.display="block"}}function filterColorSelectOnChange(e){let t,n,l=e.options[e.selectedIndex].value;"all"==l?(t=getStyle(document.body,"color"),n=getStyle(document.body,"background-color")):n=t="var(--theme-color-"+l+")",e.style.color=t,e.style.backgroundColor=n,filterTasks()}function resetNewTaskForm(){let e=document.getElementById("newtask-textarea"),t=document.getElementById("newtask-color-select"),n=document.getElementById("newtask-hide-btn");e.value="",t.selectedIndex=0,newTaskColorSelectOnChange(t),newTaskHideBtnOnClick(n)}function setTaskColor(e,t){let n=document.getElementById(e+"-color-select");n.selectedIndex=t;let l="var(--theme-color-"+n.options[n.selectedIndex].value+")";n.style.color=l,n.style.backgroundColor=l,document.getElementById(e+"-text-cont").style.color=l}function setTaskDone(e){document.getElementById(e+"-text-cont").style.textDecoration="line-through",document.getElementById(e+"-undone-label").style.display="none";let t=document.getElementById(e+"-done-label");"none"==getStyle(document.getElementById(e+"-textarea"),"display")?t.style.display="inline-block":t.style.display="none"}function setTaskUndone(e){document.getElementById(e+"-text-cont").style.textDecoration="none",document.getElementById(e+"-done-label").style.display="none";let t=document.getElementById(e+"-undone-label");"none"==getStyle(document.getElementById(e+"-textarea"),"display")?t.style.display="inline-block":t.style.display="none"}function setTaskState(e,t){t?setTaskDone(e):setTaskUndone(e)}function setTaskText(e,t){let n=document.getElementById(e+"-textarea");if(""==t){return void taskRemoveBtnOnClick(document.getElementById(e+"-remove-btn"))}let l=document.getElementById(e+"-text-cont");l.innerHTML=t,n.style.display="none";let o=document.getElementById(e+"-form"),d=document.getElementById(e+"-btn-cont");o.style.height=getStyle(d,"height"),l.style.display="block",document.getElementById(e+"-ok-btn").style.display="none",document.getElementById(e+"-undone-label").style.display="inline-block"}function newTaskAddBtnOnClick(e){let t=document.getElementById("newtask-textarea");if(""==t.value.replace(/\s/g,""))return;let n=document.getElementById("newtask-color-select");addTask(t.value.trim(),n.selectedIndex,0)}function newTaskNewBtnOnClick(e){document.getElementById("newtask-form").style.height="100%",document.getElementById("newtask-add-btn").style.display="inline-block",document.getElementById("newtask-color-select").style.display="inline-block",document.getElementById("newtask-hide-btn").style.display="inline-block";let t=document.getElementById("newtask-textarea");t.style.display="inline-block",t.focus();let n=parseInt(getStyle(e.parentNode,"height"))+t.clientHeight+"px";document.getElementById("newtask-form").style.height=n,e.style.display="none"}function newTaskHideBtnOnClick(e){document.getElementById("newtask-form").style.height=getStyle(e,"height"),document.getElementById("newtask-add-btn").style.display="none",document.getElementById("newtask-color-select").style.display="none",document.getElementById("newtask-new-btn").style.display="inline-block",document.getElementById("newtask-textarea").style.display="none",e.style.display="none"}function newTaskColorSelectOnChange(e){let t="var(--theme-color-"+e.options[e.selectedIndex].value+")";e.style.color=t,e.style.backgroundColor=t}function taskRemoveBtnOnClick(e){removeTask(extractTaskIdPrefix(e.id))}function taskDateContOnDoubleClick(e){taskTextContOnDoubleClick(document.getElementById(extractTaskIdPrefix(e.id)+"-text-cont"))}function taskColorSelectOnChange(e){changeTaskColor(extractTaskIdPrefix(e.id),e.selectedIndex)}function taskUndoneLabelOnClick(e){changeTaskState(extractTaskIdPrefix(e.id),1)}function taskDoneLabelOnClick(e){changeTaskState(extractTaskIdPrefix(e.id),0)}function taskTextareaOnFocusOut(e){changeTaskText(extractTaskIdPrefix(e.id),e.value.trim())}function taskTextContOnDoubleClick(e){e.style.display="none";let t=extractTaskIdPrefix(e.id),n=document.getElementById(t+"-form");n.style.height="auto";let l=document.getElementById(t+"-textarea");l.value=e.innerHTML,l.style.display="inline-block";let o=document.getElementById(t+"-btn-cont"),d=parseInt(getStyle(o,"height"))+l.clientHeight+"px";n.style.height=d;let a=document.getElementById(t+"-done-label");a.style.display="none",document.getElementById(t+"-undone-label").style.display="none",taskDoneLabelOnClick(a),document.getElementById(t+"-ok-btn").style.display="inline-block",l.focus()}function createTaskDbIdCont(e,t){let n=document.createElement("span");return n.id=e+"-db-id",n.style.display="none",n.innerHTML=t,n}function createTaskDateCont(e,t){let n=document.createElement("span");n.id=e+"-date",n.classList.add("task-date-cont");let l=()=>taskDateContOnDoubleClick(n);return n.addEventListener("click",()=>doubleClickHook(l)),n.innerHTML=timeToStr(t),n}function createTaskRemoveBtn(e){let t=document.createElement("button");return t.id=e+"-remove-btn",t.classList.add("task-btn"),t.type="button",t.addEventListener("click",function(){taskRemoveBtnOnClick(this)}),t.style.display="inline-block",t.innerHTML="remove",t}function createTaskColorOption(e,t){let n=document.createElement("option");return n.id=e+"-color-option-"+t,n.classList.add("task-color-opt"),n.value=t,n.innerHTML=t,n}function createTaskColorSelect(e,t){let n=document.createElement("select");n.id=e+"-color-select",n.classList.add("task-color-select"),n.addEventListener("change",function(){taskColorSelectOnChange(this)});for(let t=0;t<taskColors.length;t++){let l=createTaskColorOption(e,taskColors[t]);n.appendChild(l)}n.selectedIndex=t;let l="var(--theme-color-"+taskColors[t]+")";return n.style.backgroundColor=n.style.color=l,n.style.display="inline-block",n}function createTaskOkBtn(e){let t=document.createElement("button");return t.id=e+"-ok-btn",t.classList.add("task-btn"),t.type="button",t.innerHTML="ok",t}function createTaskUndoneLabel(e,t){let n=document.createElement("label");return n.id=e+"-undone-label",n.classList.add("done-label"),n.addEventListener("click",function(){taskUndoneLabelOnClick(this)}),0==t&&(n.style.display="inline-block"),n.innerHTML="&nbsp",n}function createTaskDoneLabel(e,t){let n=document.createElement("label");return n.id=e+"-done-label",n.classList.add("done-label"),n.addEventListener("click",function(){taskDoneLabelOnClick(this)}),0!=t&&(n.style.display="inline-block"),n.innerHTML="&#x2713",n}function createTaskBtnCont(e,t,n){let l=document.createElement("div");l.id=e+"-btn-cont",l.classList.add("task-btn-cont");let o=createTaskRemoveBtn(e),d=createTaskColorSelect(e,t),a=createTaskOkBtn(e),s=createTaskUndoneLabel(e,n),c=createTaskDoneLabel(e,n);return l.appendChild(o),l.appendChild(d),l.appendChild(a),l.appendChild(s),l.appendChild(c),l}function createTaskTextarea(e,t){let n=document.createElement("textarea");return n.id=e+"-textarea",n.classList.add("task-textarea"),n.addEventListener("focusout",function(){taskTextareaOnFocusOut(this)}),n.setAttribute("maxlength",65535),n.innerHTML=t,n}function createTaskForm(e,t,n,l,o){let d=document.createElement("form");d.id=e+"-form",d.classList.add("task-form"),d.style.height="auto";let a=createTaskDateCont(e,t),s=createTaskBtnCont(e,l,o),c=createTaskTextarea(e,n);return d.appendChild(a),d.appendChild(s),d.appendChild(c),d}function createTaskTextCont(e,t,n,l){let o=document.createElement("div");o.id=e+"-text-cont",o.classList.add("task-text-cont");let d="var(--theme-color-"+taskColors[n]+")";o.style.color=d,0!=l&&(o.style.textDecoration="line-through"),o.innerHTML=t;let a=()=>taskTextContOnDoubleClick(o);return o.addEventListener("click",()=>doubleClickHook(a)),o}function createTaskCont(e,t,n,l,o,d){let a=document.createElement("div");a.id=e+"-cont",a.classList.add("task-cont");let s=document.createElement("br"),c=document.createElement("hr"),i=document.createElement("br"),r=createTaskDbIdCont(e,t),u=createTaskForm(e,n,l,o,d),m=createTaskTextCont(e,l,o,d);return a.appendChild(s),a.appendChild(c),a.appendChild(i),a.appendChild(r),a.appendChild(u),a.appendChild(m),a}function showTask(e,t,n,l,o){insertAfter(createTaskCont("task"+_taskIndex++,e,t,n,l,o),document.getElementById("newtask-cont"))}function showLoadedTasks(e){for(let t=0;t<e.length;t++)showTask(e[t].dbId,e[t].date,e[t].text,e[t].color,e[t].done)}function loadTasks(){useClient&&clientGetTasks(showLoadedTasks)}function showAddedTask(e,t){e&&(showTask(e.dbId,e.date,t.text,t.color,t.done),resetNewTaskForm())}function addTask(e,t,n){if(!useClient){return showTask(0,(new Date).getTime(),e,t,n),void resetNewTaskForm()}let l=new Object;l.text=e,l.color=t,l.done=n,clientAddTask(l,e=>showAddedTask(e,l))}function wipeRemovedTask(e,t){e&&removeElementById(t+"-cont")}function removeTask(e){if(!useClient)return void removeElementById(e+"-cont");let t=document.getElementById(e+"-db-id").innerHTML;clientRemoveTask(t,t=>wipeRemovedTask(t,e))}function updateTaskColor(e,t,n){if(!e)return;setTaskColor(t,n);let l=document.getElementById("filter-color-select"),o=l.options[l.selectedIndex].value,d=taskColors.indexOf(o);if(-1!=d&&d!=n){document.getElementById(t+"-cont").style.display="none"}}function changeTaskColor(e,t){if(!useClient)return void setTaskColor(e,t);let n=new Object;n.dbId=document.getElementById(e+"-db-id").innerHTML,n.color=t,clientEditTask(n,n=>updateTaskColor(n,e,t))}function updateTaskState(e,t,n){if(!e)return;setTaskState(t,n);let l=document.getElementById("filter-done-select"),o=l.options[l.selectedIndex].value;if("done"==o&&0==n||"undone"==o&&1==n){document.getElementById(t+"-cont").style.display="none"}}function changeTaskState(e,t){if(!useClient)return void setTaskState(e,t);let n=new Object;n.dbId=document.getElementById(e+"-db-id").innerHTML,n.done=t,clientEditTask(n,n=>updateTaskState(n,e,t))}function updateTaskText(e,t,n){e&&setTaskText(t,n)}function changeTaskText(e,t){if(!useClient)return void setTaskText(e,t);let n=new Object;n.dbId=document.getElementById(e+"-db-id").innerHTML,n.text=t,clientEditTask(n,n=>updateTaskText(n,e,t))}